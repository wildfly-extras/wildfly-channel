<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <title>Channel App</title>
    <style type="text/css" media="screen">
.ace_editor {
  border: 1px solid lightgray;
  height: 600px;
  width: 80%;
  font-size: 12pt
}

</style>
    <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
    <!-- CSS
      –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/skeleton.css">
    <!-- Favicon
      –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="icon" type="image/png" href="images/favicon.png">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>

<div class="container">

    <h1>Channel App</h1>


    <form id="channel-form" method="post" onsubmit="javascript: return process();">
        <h2>Channels Definitions <small>[<a href="/schema">Schema</a>]</small></h2>
        <div class="row">
                <div class="ace_editor" id="editor"># Paste channel YAML definitions here</div>
            <input type="hidden" id="channels" name="channels">
        </div>
        <div class="row">
            <pre><div id="warnings"></div></pre>
        </div>
        <hr />
        <div class="row">
            <input class="button-primary" id="validator" type="submit" value="Validate">
        </div>
        <br>

        <h2>Maven Artifact Resolver</h2>
        <div class="row">
            <div class="three columns">
                <label for="groupId">groupId</label>
                <input class="u-full-width" placeholder="org.wildfly" id="groupId" name="groupId">
            </div>
            <div class="three columns">
                <label for="artifactId">artifactId</label>
                <input class="u-full-width" placeholder="wildfly-ee-galleon-pack" id="artifactId" name="artifactId">
            </div>
            <div class="three columns">
                <label for="extension">extension</label>
                <input class="u-full-width" placeholder="zip" id="extension" name="extension">
            </div>
            <div class="two columns">
                <label for="version">version</label>
                <input class="u-full-width" id="version" placeholder="latest" name="version">
            </div>
            <div class="one columns">
                <label for="latest">Latest?</label>
                <input class="u-full-width" type="checkbox" id="latest" name="latest">
            </div>
        </div>
        <div class="row">
            <div class="two columns">
                <input class="button-primary" type="submit" id="resolve-button" value="Resolve">
            </div>
            <div class="ten columns">
                <pre id="pre-version" hidden><code><p id="latest-version"></p></code></pre>
            </div>
        </div>
    </form>
</div>
<script src="/js/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
var editor = ace.edit("editor");
editor.setTheme("ace/theme/dracula");
editor.session.setMode("ace/mode/yaml");

function process() {
  document.getElementById("channels").value = editor.getValue();
  return true;
}

$(document).ready(function(){

 $("#validator").click(function(event){
    event.preventDefault();
    process();
    console.log("validate schema");
    $.ajax({
      type: "post",
      url: "/validate",
      data: $("#channels").serialize(),
      dataType: "text",
      success: function(response) {
        $("#warnings").text(response);
      },
      error: function (jqXHR, textStatus, errorThrown) {
        $("#warnings").text(errorThrown.message);
      }
    });
  });

 $("#resolve-button").click(function(event){
    event.preventDefault();
    process();
    $("#pre-version").show();
    $("#latest-version").text("...");
    console.log("get latest version");
    $.ajax({
      type: "post",
      url: "/resolve",
      data: $("#channel-form").serialize(),
      dataType: "text",
      success: function(response) {
        $("#latest-version").text(response);
      },
      error: function (jqXHR, textStatus, errorThrown) {
        $("#latest-version").text(errorThrown.message);
      }
    });
  });
});

</script>

</body>
</html>